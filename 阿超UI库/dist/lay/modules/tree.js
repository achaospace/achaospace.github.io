/** byui-v2.5.4 MIT License By https://www.byui.com */
 ;byui.define("form",function(e){"use strict";var i=byui.$,n=byui.form,r="tree",t={config:{},index:byui[r]?byui[r].index+1e4:0,set:function(e){var n=this;return n.config=i.extend({},n.config,e),n},on:function(e,i){return byui.onevent.call(this,r,e,i)}},a=function(){var e=this,i=e.config,n=i.id||e.index;return a.that[n]=e,a.config[n]=i,{config:i,reload:function(i){e.reload.call(e,i)},getChecked:function(){return e.getChecked.call(e)},setChecked:function(i){return e.setChecked.call(e,i)}}},d="byui-hide",s="byui-disabled",c="byui-tree-set",l="byui-tree-iconClick",o="byui-icon-addition",h="byui-icon-subtraction",u="byui-tree-entry",f="byui-tree-main",p="byui-tree-txt",y="byui-tree-pack",b="byui-tree-spread",v="byui-tree-setLineShort",C="byui-tree-showLine",m="byui-tree-lineExtend",k=function(e){var n=this;n.index=++t.index,n.config=i.extend({},n.config,t.config,e),n.render()};k.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},k.prototype.reload=function(e){var n=this;byui.each(e,function(e,i){i.constructor===Array&&delete n.config[e]}),n.config=i.extend(!0,{},n.config,e),n.render()},k.prototype.render=function(){var e=this,n=e.config,r=i('<div class="byui-tree'+(n.showCheckbox?" byui-form":"")+(n.showLine?" byui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(r);var t=n.elem=i(n.elem);if(t[0]){if(n.showSearch&&r.prepend('<input type="text" class="byui-input byui-tree-search" placeholder="请输入关键字进行过滤">'),e.key=n.id||e.index,e.elem=r,e.elemNone=i('<div class="byui-tree-emptyText">'+n.text.none+"</div>"),t.html(e.elem),0==e.elem.find(".byui-tree-set").length)return e.elem.append(e.elemNone);n.drag&&e.drag(),n.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".byui-tree-set").each(function(){var e=i(this);e.parent(".byui-tree-pack")[0]||e.addClass("byui-tree-setHide"),!e.next()[0]&&e.parents(".byui-tree-pack").eq(1).hasClass("byui-tree-lineExtend")&&e.addClass(v),e.next()[0]||e.parents(".byui-tree-set").eq(0).next()[0]||e.addClass(v)}),e.events()}},k.prototype.renderForm=function(e){n.render(e,"LAY-tree-"+this.index)},k.prototype.tree=function(e,n){var r=this,t=r.config,a=n||t.data;byui.each(a,function(n,a){var l=a.children&&a.children.length>0,o=i('<div class="byui-tree-pack" '+(a.spread?'style="display: block;"':"")+'"></div>'),h=i(['<div data-id="'+a.id+'" class="byui-tree-set'+(a.spread?" byui-tree-spread":"")+(a.checked?" byui-tree-checkedFirst":"")+'">',"<div "+(t.drag&&!a.fixed?'draggable="true"':"")+' class="byui-tree-entry">','<div class="byui-tree-main">',function(){return t.showLine?l?'<span class="byui-tree-iconClick byui-tree-icon"><i class="byui-icon '+(a.spread?"byui-icon-subtraction":"byui-icon-addition")+'"></i></span>':'<span class="byui-tree-iconClick"><i class="byui-icon byui-icon-file"></i></span>':'<span class="byui-tree-iconClick"><i class="byui-tree-iconArrow '+(l?"":d)+'"></i></span>'}(),function(){return t.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(a.disabled?"disabled":"")+'  value="'+a.id+'">':""}(),function(){return t.isJump&&a.href?'<a href="'+a.href+'" target="_blank" class="'+p+'">'+(a.title||a.label||t.text.defaultNodeName)+"</a>":'<span class="'+p+(a.disabled?" "+s:"")+'">'+(a.title||a.label||t.text.defaultNodeName)+"</span>"}(),"</div>",function(){if(!t.edit)return"";var e={add:'<i class="byui-icon byui-icon-add-1"  data-type="add"></i>',update:'<i class="byui-icon byui-icon-edit" data-type="update"></i>',del:'<i class="byui-icon byui-icon-delete" data-type="del"></i>'},i=['<div class="byui-btn-group byui-tree-btnGroup">'];return t.edit===!0&&(t.edit=["update","del"]),"object"==typeof t.edit?(byui.each(t.edit,function(n,r){i.push(e[r]||"")}),i.join("")+"</div>"):void 0}(),"</div></div>"].join(""));l&&(h.append(o),r.tree(o,a.children)),e.append(h),h.prev("."+c)[0]&&h.prev().children(".byui-tree-pack").addClass("byui-tree-showLine"),l||h.parent(".byui-tree-pack").addClass("byui-tree-lineExtend"),r.spread(h,a),t.showCheckbox&&r.checkClick(h,a),t.edit&&r.operate(h,a)})},k.prototype.spread=function(e,n){var r=this,t=r.config,a=e.children("."+u),d=a.children("."+f),v=a.find("."+l),C=a.find("."+p),m=t.onlyIconControl?v:d,k="";m.on("click",function(i){var n=e.children("."+y),r=m.children(".byui-icon")[0]?m.children(".byui-icon"):m.find(".byui-tree-icon").children(".byui-icon");if(n[0]){if(e.hasClass(b))e.removeClass(b),n.slideUp(200),r.removeClass(h).addClass(o);else if(e.addClass(b),n.slideDown(200),r.addClass(h).removeClass(o),t.accordion){var a=e.siblings("."+c);a.removeClass(b),a.children("."+y).slideUp(200),a.find(".byui-tree-icon").children(".byui-icon").removeClass(h).addClass(o)}}else k="normal"}),C.on("click",function(){var r=i(this);r.hasClass(s)||(k=e.hasClass(b)?t.onlyIconControl?"open":"close":t.onlyIconControl?"close":"open",t.click&&t.click({elem:e,state:k,data:n}))})},k.prototype.setCheckbox=function(e,i,n){var r=this,t=(r.config,n.prop("checked"));if("object"==typeof i.children||e.find("."+y)[0]){var a=e.find("."+y).find('input[name="layuiTreeCheck"]');a.each(function(){this.disabled||(this.checked=t)})}var d=function(e){if(e.parents("."+c)[0]){var i,n=e.parent("."+y),r=n.parent(),a=n.prev().find('input[name="layuiTreeCheck"]');t?a.prop("checked",t):(n.find('input[name="layuiTreeCheck"]').each(function(){this.checked&&(i=!0)}),i||a.prop("checked",!1)),d(r)}};d(e),r.renderForm("checkbox")},k.prototype.checkClick=function(e,n){var r=this,t=r.config,a=e.children("."+u),d=a.children("."+f);d.on("click",'input[name="layuiTreeCheck"]+',function(a){byui.stope(a);var d=i(this).prev(),s=d.prop("checked");d.prop("disabled")||(r.setCheckbox(e,n,d),t.oncheck&&t.oncheck({elem:e,checked:s,data:n}))})},k.prototype.operate=function(e,n){var r=this,t=r.config,a=e.children("."+u),s=a.children("."+f);a.children(".byui-tree-btnGroup").on("click",".byui-icon",function(a){byui.stope(a);var f=i(this).data("type"),k=e.children("."+y),g={data:n,type:f,elem:e};if("add"==f){k[0]||(t.showLine?(s.find("."+l).addClass("byui-tree-icon"),s.find("."+l).children(".byui-icon").addClass(o).removeClass("byui-icon-file")):s.find(".byui-tree-iconArrow").removeClass(d),e.append('<div class="byui-tree-pack"></div>'));var x=t.operate&&t.operate(g),w={};if(w.title=t.text.defaultNodeName,w.id=x,r.tree(e.children("."+y),[w]),t.showLine)if(k[0])k.hasClass(m)||k.addClass(m),e.find("."+y).each(function(){i(this).children("."+c).last().addClass(v)}),k.children("."+c).last().prev().hasClass(v)?k.children("."+c).last().prev().removeClass(v):k.children("."+c).last().removeClass(v),!e.parent("."+y)[0]&&e.next()[0]&&k.children("."+c).last().removeClass(v);else{var T=e.siblings("."+c),L=1,N=e.parent("."+y);byui.each(T,function(e,n){i(n).children("."+y)[0]||(L=0)}),1==L?(T.children("."+y).addClass(C),T.children("."+y).children("."+c).removeClass(v),e.children("."+y).addClass(C),N.removeClass(m),N.children("."+c).last().children("."+y).children("."+c).last().addClass(v)):e.children("."+y).children("."+c).addClass(v)}if(!t.showCheckbox)return;if(s.find('input[name="layuiTreeCheck"]')[0].checked){var A=e.children("."+y).children("."+c).last();A.find('input[name="layuiTreeCheck"]')[0].checked=!0}r.renderForm("checkbox")}else if("update"==f){var q=s.children("."+p).html();s.children("."+p).html(""),s.append('<input type="text" class="byui-tree-editInput">'),s.children(".byui-tree-editInput").val(q).focus();var F=function(e){var i=e.val().trim();i=i?i:t.text.defaultNodeName,e.remove(),s.children("."+p).html(i),g.data.title=i,t.operate&&t.operate(g)};s.children(".byui-tree-editInput").blur(function(){F(i(this))}),s.children(".byui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),F(i(this)))})}else{if(t.operate&&t.operate(g),g.status="remove",!e.prev("."+c)[0]&&!e.next("."+c)[0]&&!e.parent("."+y)[0])return e.remove(),void r.elem.append(r.elemNone);if(e.siblings("."+c).children("."+u)[0]){if(t.showCheckbox){var I=function(e){if(e.parents("."+c)[0]){var n=e.siblings("."+c).children("."+u),t=e.parent("."+y).prev(),a=t.find('input[name="layuiTreeCheck"]')[0],d=1,s=0;0==a.checked&&(n.each(function(e,n){var r=i(n).find('input[name="layuiTreeCheck"]')[0];0!=r.checked||r.disabled||(d=0),r.disabled||(s=1)}),1==d&&1==s&&(a.checked=!0,r.renderForm("checkbox"),I(t.parent("."+c))))}};I(e)}if(t.showLine){var T=e.siblings("."+c),L=1,N=e.parent("."+y);byui.each(T,function(e,n){i(n).children("."+y)[0]||(L=0)}),1==L?(k[0]||(N.removeClass(m),T.children("."+y).addClass(C),T.children("."+y).children("."+c).removeClass(v)),e.next()[0]?N.children("."+c).last().children("."+y).children("."+c).last().addClass(v):e.prev().children("."+y).children("."+c).last().addClass(v),e.next()[0]||e.parents("."+c)[1]||e.parents("."+c).eq(0).next()[0]||e.prev("."+c).addClass(v)):!e.next()[0]&&e.hasClass(v)&&e.prev().addClass(v)}}else{var H=e.parent("."+y).prev();if(t.showLine){H.find("."+l).removeClass("byui-tree-icon"),H.find("."+l).children(".byui-icon").removeClass(h).addClass("byui-icon-file");var S=H.parents("."+y).eq(0);S.addClass(m),S.children("."+c).each(function(){i(this).children("."+y).children("."+c).last().addClass(v)})}else H.find(".byui-tree-iconArrow").addClass(d);e.parents("."+c).eq(0).removeClass(b),e.parent("."+y).remove()}e.remove()}})},k.prototype.drag=function(){var e=this,n=e.config;e.elem.on("dragstart","."+u,function(){var e=i(this).parent("."+c),r=e.parents("."+c)[0]?e.parents("."+c).eq(0):"未找到父节点";n.dragstart&&n.dragstart(e,r)}),e.elem.on("dragend","."+u,function(r){var r=r||event,t=r.clientY,a=i(this),s=a.parent("."+c),f=s.height(),p=s.offset().top,k=e.elem.find("."+c),g=e.elem.height(),x=e.elem.offset().top,w=g+x-13,T=s.parents("."+c)[0],L=s.next()[0];if(T)var N=s.parent("."+y),A=s.parents("."+c).eq(0),q=A.parent("."+y),F=A.offset().top,I=s.siblings(),H=A.children("."+y).children("."+c).length;var S=function(r){if(T||L||e.elem.children("."+c).last().children("."+y).children("."+c).last().addClass(v),!T)return void s.removeClass("byui-tree-setHide");if(1==H)n.showLine?(r.find("."+l).removeClass("byui-tree-icon"),r.find("."+l).children(".byui-icon").removeClass(h).addClass("byui-icon-file"),q.addClass(m),q.children("."+c).children("."+y).each(function(){i(this).children("."+c).last().addClass(v)})):r.find(".byui-tree-iconArrow").addClass(d),r.children("."+y).remove(),r.removeClass(b);else{if(n.showLine){var t=1;byui.each(I,function(e,n){i(n).children("."+y)[0]||(t=0)}),1==t?(s.children("."+y)[0]||(N.removeClass(m),I.children("."+y).addClass(C),I.children("."+y).children("."+c).removeClass(v)),N.children("."+c).last().children("."+y).children("."+c).last().addClass(v),L||r.parents("."+c)[0]||r.next()[0]||N.children("."+c).last().addClass(v)):!L&&s.hasClass(v)&&N.children("."+c).last().addClass(v)}if(n.showCheckbox){var a=function(n){if(n){if(!n.parents("."+c)[0])return}else if(!r[0])return;var t=n?n.siblings().children("."+u):I.children("."+u),d=n?n.parent("."+y).prev():N.prev(),s=d.find('input[name="layuiTreeCheck"]')[0],l=1,o=0;0==s.checked&&(t.each(function(e,n){var r=i(n).find('input[name="layuiTreeCheck"]')[0];0!=r.checked||r.disabled||(l=0),r.disabled||(o=1)}),1==l&&1==o&&(s.checked=!0,e.renderForm("checkbox"),a(d.parent("."+c)||r)))};a()}}};k.each(function(){if(0!=i(this).height()){if(t>p&&t<p+f)return void(n.dragend&&n.dragend("drag error"));if(1==H&&t>F&&t<p+f)return void(n.dragend&&n.dragend("drag error"));var r=i(this).offset().top;if(t>r&&t<r+15){if(i(this).children("."+y)[0]||(n.showLine?(i(this).find("."+l).eq(0).addClass("byui-tree-icon"),i(this).find("."+l).eq(0).children(".byui-icon").addClass(o).removeClass("byui-icon-file")):i(this).find(".byui-tree-iconArrow").removeClass(d),i(this).append('<div class="byui-tree-pack"></div>')),i(this).children("."+y).append(s),S(A),n.showLine){var a=i(this).children("."+y).children("."+c);if(s.children("."+y).children("."+c).last().addClass(v),1==a.length){var h=i(this).siblings("."+c),b=1,k=i(this).parent("."+y);byui.each(h,function(e,n){i(n).children("."+y)[0]||(b=0)}),1==b?(h.children("."+y).addClass(C),h.children("."+y).children("."+c).removeClass(v),i(this).children("."+y).addClass(C),k.removeClass(m),k.children("."+c).last().children("."+y).children("."+c).last().addClass(v).removeClass("byui-tree-setHide")):i(this).children("."+y).children("."+c).addClass(v).removeClass("byui-tree-setHide")}else s.prev("."+c).hasClass(v)?(s.prev("."+c).removeClass(v),s.addClass(v)):(s.removeClass("byui-tree-setLineShort byui-tree-setHide"),s.children("."+y)[0]?s.prev("."+c).children("."+y).children("."+c).last().removeClass(v):s.siblings("."+c).find("."+y).each(function(){i(this).children("."+c).last().addClass(v)})),i(this).next()[0]||s.addClass(v)}if(n.showCheckbox&&i(this).children("."+u).find('input[name="layuiTreeCheck"]')[0].checked){var g=s.children("."+u);g.find('input[name="layuiTreeCheck"]+').click()}return n.dragend&&n.dragend("drag success",s,i(this)),!1}if(t<r){if(i(this).before(s),S(A),n.showLine){var x=s.children("."+y),T=i(this).parents("."+c).eq(0),L=T.children("."+y).children("."+c).last();if(x[0]){s.removeClass(v),x.children("."+c).last().removeClass(v);var h=s.siblings("."+c),b=1;byui.each(h,function(e,n){i(n).children("."+y)[0]||(b=0)}),1==b?T[0]&&(h.children("."+y).addClass(C),h.children("."+y).children("."+c).removeClass(v),L.children("."+y).children("."+c).last().addClass(v).removeClass(C)):s.children("."+y).children("."+c).last().addClass(v),!T.parent("."+y)[0]&&T.next()[0]&&L.removeClass(v)}else T.hasClass(m)||T.addClass(m),T.find("."+y).each(function(){i(this).children("."+c).last().addClass(v)});T[0]||(s.addClass("byui-tree-setHide"),s.children("."+y).children("."+c).last().removeClass(v))}if(T[0]&&n.showCheckbox&&T.children("."+u).find('input[name="layuiTreeCheck"]')[0].checked){var g=s.children("."+u);g.find('input[name="layuiTreeCheck"]+').click()}return n.dragend&&n.dragend("拖拽成功，插入目标节点上方",s,i(this)),!1}if(t>w)return e.elem.children("."+c).last().children("."+y).addClass(C),e.elem.append(s),S(A),s.prev().children("."+y).children("."+c).last().removeClass(v),s.addClass("byui-tree-setHide"),s.children("."+y).children("."+c).last().addClass(v),n.dragend&&n.dragend("拖拽成功，插入最外层节点",s,e.elem),!1}})})},k.prototype.events=function(){var e=this,n=e.config,r=e.elem.find(".byui-tree-checkedFirst");byui.each(r,function(e,n){i(n).children("."+u).find('input[name="layuiTreeCheck"]+').trigger("click")}),e.elem.find(".byui-tree-search").on("keyup",function(){var r=i(this),t=r.val(),a=r.nextAll(),s=[];a.find("."+p).each(function(){var e=i(this).parents("."+u);if(i(this).html().indexOf(t)!=-1){s.push(i(this).parent());var n=function(e){e.addClass("byui-tree-searchShow"),e.parent("."+y)[0]&&n(e.parent("."+y).parent("."+c))};n(e.parent("."+c))}}),a.find("."+u).each(function(){var e=i(this).parent("."+c);e.hasClass("byui-tree-searchShow")||e.addClass(d)}),0==a.find(".byui-tree-searchShow").length&&e.elem.append(e.elemNone),n.onsearch&&n.onsearch({elem:s})}),e.elem.find(".byui-tree-search").on("keydown",function(){i(this).nextAll().find("."+u).each(function(){var e=i(this).parent("."+c);e.removeClass("byui-tree-searchShow "+d)}),i(".byui-tree-emptyText")[0]&&i(".byui-tree-emptyText").remove()})},k.prototype.getChecked=function(){var e=this,n=e.config,r=[],t=[];e.elem.find(".byui-form-checked").each(function(){r.push(i(this).prev()[0].value)});var a=function(e,n){byui.each(e,function(e,t){byui.each(r,function(e,r){if(t.id==r){var d=i.extend({},t);return delete d.children,n.push(d),t.children&&(d.children=[],a(t.children,d.children)),!0}})})};return a(i.extend({},n.data),t),t},k.prototype.setChecked=function(e){var n=this;n.config;n.elem.find("."+c).each(function(n,r){var t=i(this).data("id"),a=i(r).children("."+u).find('input[name="layuiTreeCheck"]'),d=a.next();if("number"==typeof e){if(t==e)return a[0].checked||d.click(),!1}else i.inArray(t,e)!=-1&&(a[0].checked||d.click())})},a.that={},a.config={},t.reload=function(e,i){var n=a.that[e];return n.reload(i),a.call(n)},t.getChecked=function(e){var i=a.that[e];return i.getChecked()},t.setChecked=function(e,i){var n=a.that[e];return n.setChecked(i)},t.render=function(e){var i=new k(e);return a.call(i)},e(r,t)});